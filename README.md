# Configuration files for current OpenPATH deployments

Publishing them on GitHub allows transparency around how they are configured.
This may not be the long-term solution, but it allows us to make progress over the short/medium term.

### Creating a new Config

Automation has been introduced for creating new config files. New deployers can now file a [templated issue](https://github.com/e-mission/nrel-openpath-deploy-configs/issues/new?assignees=&labels=new+config&projects=&template=add-new-config.yml&title=New+Project+Configuration+-+%5BPROJECT%5D) specifying their configuration, which will launch a GitHub Actions workflow with a pull request to add the new config to this repo. Additional steps may be required if they require additional customization of surveys or labels. 

Info for parthers: [in the docs](https://github.com/e-mission/e-mission-docs/tree/master/docs/use/start_a_project.md)
Info for developers: [in the docs](https://github.com/e-mission/e-mission-docs/tree/master/docs/dev/future/more_custom_auto_config.md)

Config file submission will begin the process of creating an admin dashboard and associated user pool for the project. In order to log in, users will need to generate an account. This process will be automated, but may occasionally need to be run manually if there are errors in the initial config submission. To generate an account, users will need to install boto3. Please install boto3 in your virtualenv, conda env, or local machine per your preferences:

#Run the following command in terminal:

`pip install boto3`  

#Run the email-config.py script, and pass the path to the config file in as an argument:

`python email-config.py -l /path/to/configfile.nrel-op.json`

An email with instructions + admin dashboard link will be sent to all emails listed in the admin access section.

### Reviewing and testing
- contact us by email at openpath@nrel.gov for access to staging apps (Android or IOS)
- also reach out to recieve an OPcode for stage study or stage program
  
#### Programs vs studies

NREL OpenPATH supports both _studies_ and _programs_. While most of the functionality is the same, studies and programs are subtly different - for example:
- studies support autogenerated tokens, while programs require a token from the program admin
- programs include a question for the mode that would have been used if the program intervention was not available

#### Stage study environment

If you are here to preview/review/beta test the app functionality, please use the stage study environment (see instructions above for requesting access)

#### Stage program environment

If you want to experiment with the stage environment for _programs_ please use the stage program environment (see instructions above for requesting access)

If you are here to test out the app on your personal phone, please use the open-access environment (https://open-access-openpath.nrel.gov/join)

In general, if you are planning to keep the app installed for less than a day, please use stage so you don't pollute the real dataset.

#### Testing local configs on e-mission-phone

As we test more config options, we sometimes need to be able to test local config changes without pushing to GitHub and waiting for a PR to be approved.

To accomplish this:
- Modify one of the existing configs in your local repo or create a new one (e.g. my-deployment.nrel-op.json)
- `docker-compose -f docker-compose.dev.yml up -d` to serve your local configs on localhost:9090
- With an emulator running e-mission-phone, log in with an opcode for that deployment (e.g. nrelop_my-deployment_1234)
- As long as you are not using a 'production' build of e-mission-phone, the app will check localhost:9090 before it checks GitHub
- You can use "Profile" > "Refresh App Configuration" to quickly test additional changes as long as "version" is incremented in your new version of the config

### Config options

Example config format (with default values) is:

```
{
    "version": 1,
    "server": {
        "url": "https://openpath-stage.nrel.gov/api/",
        "aggregate_call_auth": "user_only"
    },
    "intro": {
        "program_or_study": "study",
        "program_admin_contact": "K. Shankari",
        "deployment_partner_name": "National Renewable Energy Laboratory (NREL)",
        "translated_text": {
            "en": {
                "deployment_name": "Open Access Study",
                "summary_line_1": "enables people to track their travel modes and measure their associated energy use and emissions",
                "summary_line_2": "makes aggregated data on mode shares, trip frequencies, and carbon footprints available via a public dashboard",
                "summary_line_3": "serves as a control group while evaluating behavior change of programs.",
                "short_textual_description": "Transportation is the largest contributor to ...",
                "why_we_collect": "NREL can use this information to ....",
            },
            "es": {
....
            },
            "support_autogen_token": true,
        }
    }
    "display_config": {
        "use_imperial": false,
    },
    "profile_controls": {
        "support_upload": false,
        "trip_end_notification": false
    }
}
```

A TypeScript specification of all the available config options is available in `index.d.ts`.
